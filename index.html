<!doctype html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/tasbeeh.svg" />
    <link rel="shortcut icon" href="/tasbeeh.svg" />
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/public/manifest.webmanifest" />
    
    <!-- iOS Web App Meta Tags -->
    <link rel="apple-touch-icon" href="/tasbeeh.svg" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Tasbeeh" />
    
    <!-- Android Web App Meta Tags -->
    <meta name="theme-color" content="#4f46e5" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="application-name" content="Tasbeeh App" />
    
    <!-- Viewport and General Meta Tags -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=yes" />
    <meta name="description" content="ØªØ·Ø¨ÙŠÙ‚ ØªØ³Ø¨ÙŠØ­ Ø¨Ø³ÙŠØ· ÙˆØ³Ù‡Ù„ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… - Simple Tasbeeh Counter App" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="color-scheme" content="light dark" />
    
    <title>Tasbeeh App - ØªØ³Ø¨ÙŠØ­</title>
    <style>
      body {
        margin: 0;
        padding: 0;
      }
      #pwa-install-banner {
        display: none;
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        z-index: 9999;
        background: linear-gradient(135deg, #4f46e5 0%, #3b82f6 100%);
        color: white;
        padding: 16px;
        text-align: center;
        box-shadow: 0 -4px 20px rgba(79, 70, 229, 0.3);
        animation: slideUp 0.3s ease-out;
      }
      #pwa-install-banner.show {
        display: block;
      }
      @keyframes slideUp {
        from {
          transform: translateY(100%);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }
      #pwa-install-banner button {
        margin: 0 8px;
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
      }
      #pwa-install-btn {
        background: white;
        color: #4f46e5;
      }
      #pwa-install-btn:active {
        transform: scale(0.95);
      }
      #pwa-close-btn {
        background: rgba(255, 255, 255, 0.2);
        color: white;
      }
      #pwa-close-btn:active {
        background: rgba(255, 255, 255, 0.3);
      }
    </style>
  </head>
  <body>
    <div id="pwa-install-banner">
      <div style="margin-bottom: 12px; font-size: 16px; font-weight: 600;">
        ğŸ“± Ø­Ù…Ù‘Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ Ù‡Ø§ØªÙÙƒ | Download our app
      </div>
      <div>
        <button id="pwa-install-btn">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¢Ù† | Install Now</button>
        <button id="pwa-close-btn">Ø¥ØºÙ„Ø§Ù‚ | Close</button>
      </div>
    </div>
    
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
    
    <!-- PWA Installation Manager -->
    <script>
      // Global PWA state
      window.pwaInstaller = {
        prompt: null,
        userChoice: null,
        isInstallable: false,
        
        async init() {
          const banner = document.getElementById('pwa-install-banner');
          const installBtn = document.getElementById('pwa-install-btn');
          const closeBtn = document.getElementById('pwa-close-btn');
          
          // Check if already installed
          if (window.navigator.standalone === true || window.matchMedia('(display-mode: standalone)').matches) {
            console.log('âœ“ App already in standalone mode');
            return;
          }
          
          // Listen for install prompt
          window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            this.prompt = e;
            this.isInstallable = true;
            console.log('âœ“ beforeinstallprompt event fired');
            
            // Show banner after 3 seconds
            setTimeout(() => {
              banner.classList.add('show');
            }, 3000);
          });
          
          // Install button handler
          installBtn.addEventListener('click', async () => {
            if (this.prompt) {
              try {
                this.prompt.prompt();
                this.userChoice = await this.prompt.userChoice;
                
                if (this.userChoice.outcome === 'accepted') {
                  console.log('âœ“ User accepted installation');
                  banner.classList.remove('show');
                  this.prompt = null;
                } else {
                  console.log('âœ— User dismissed installation');
                }
              } catch (error) {
                console.log('Installation prompt error:', error);
              }
            } else {
              console.log('No install prompt available, redirecting to install info...');
              this.showManualInstallGuide();
            }
          });
          
          // Close button handler
          closeBtn.addEventListener('click', () => {
            banner.classList.remove('show');
          });
          
          // Listen for app installed event
          window.addEventListener('appinstalled', () => {
            console.log('âœ“ App successfully installed');
            banner.classList.remove('show');
          });
          
          // Register Service Worker
          if ('serviceWorker' in navigator) {
            try {
              const reg = await navigator.serviceWorker.register('/sw.js', {
                scope: '/',
                updateViaCache: 'none'
              });
              console.log('âœ“ Service Worker registered:', reg.scope);
              
              // Check for updates
              setInterval(() => {
                reg.update().catch(err => console.log('Update check failed:', err));
              }, 3600000);
              
              navigator.serviceWorker.addEventListener('controllerchange', () => {
                console.log('âœ“ Service Worker updated');
              });
            } catch (error) {
              console.log('âœ— Service Worker registration failed:', error);
            }
          }
          
          // Send a signal to React for manual install UI
          window.dispatchEvent(new CustomEvent('pwaready', { detail: { isInstallable: this.isInstallable } }));
        },
        
        showManualInstallGuide() {
          const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
          let message = '';
          
          if (isIOS) {
            message = 'iOS: Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ù…Ø´Ø§Ø±ÙƒØ© â†—ï¸ Ø«Ù… Ø§Ø®ØªØ± "Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©"\niOS: Tap Share â†—ï¸ then "Add to Home Screen"';
          } else {
            message = 'Android: Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© â‹® Ø«Ù… Ø§Ø®ØªØ± "ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚"\nAndroid: Tap Menu â‹® then "Install app"';
          }
          
          alert(message);
        }
      };
      
      // Initialize when DOM is ready
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
          window.pwaInstaller.init();
        });
      } else {
        window.pwaInstaller.init();
      }
    </script>
  </body>
</html>
